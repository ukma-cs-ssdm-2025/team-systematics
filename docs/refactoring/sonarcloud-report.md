# Звіт про рефакторинг та аналіз SonarCloud


## 1. Таблиця метрик (До/Після)

На основі аналізу SonarCloud, ми зосередились на трьох ключових метриках, які демонструють покращення стабільності та супровідності коду.

| Метрика | До рефакторингу (Main Branch) | Після рефакторингу (Overall Code) | Результат |
| :--- | :---: | :---: | :--- |
| **Maintainability** (Code Smells) | 52 | 22 | **Покращено** (зменшено на 30) |
| **Reliability** (Bugs) | 12 | 5 | **Покращено** (зменшено на 7) |
| **Security Hotspots** | 18 | 3 | **Покращено** (зменшено на 15) |

## 2. Опис патернів рефакторингу

Було застосовано два основні підходи до покращення коду:

### Патерн 1: `Replace API / Use built-in generics (typing.Set/List → set/list)`

* **Проблема:** Виникала помилка `NameError: name 'Set' is not defined` під час імпорту модулів у тестах, оскільки використовувалися анотації типів `Set` та `List` без відповідного імпорту з модуля `typing`.
* **Рішення:** Було проведено рефакторинг коду для використання сучасних вбудованих узагальнень (generics) Python (наприклад, `typing.Set` замінено на `set`).
* **Приклад:**
    ```python
    # До
    - def _normalize(items: Iterable[str] | None) -> Set[str]:
    # Після
    + def _normalize(items: Iterable[str] | None) -> set[str]:
    ```

### Патерн 2: Покращення стійкості конфігурації (CI/App Config)

* **Проблема:** Тести в CI-пайплайні падали через невалідний `DATABASE_URL`, оскільки змінні середовища `.env` не були доступні, що призводило до помилок під час імпорту SQLAlchemy.
* **Рішення:**
    1.  Додано fallback на `sqlite:///:memory:` у `config.py`, якщо змінні оточення для PostgreSQL не задані.
    2.  Явно встановлено `DATABASE_URL: "sqlite:///:memory:"` у конфігурації CI-воркфлоу для стабільного проходження тестів.

## 3. Скриншоти з SonarCloud

### До рефакторингу (Main Branch)

![SonarCloud до змін](image_fc3869.png)

### Після рефакторингу (Overall Code)

![SonarCloud після змін](image_fc38aa.png)

## 4. Результати регресійного тестування

Рефакторинг був спрямований на виправлення помилок імпорту та стабілізацію тестового середовища. Тестування підтвердило, що зміни були успішними і не зламали існуючу функціональність:

* **Виправлення помилки:** Модуль `src/core/security.py` тепер імпортується без помилок `NameError`.
* **Проходження тестів (Локально):** Усі пов’язані тести (`tests/api/core/test_security_roles.py`) проходять успішно.
* **Проходження тестів (CI):** Після виправлення конфігурації CI, Pytest коректно збирає та виконує всі тести, поведінка в CI тепер узгоджена з локальним виконанням.# Звіт про рефакторинг та аналіз SonarCloud

Цей документ описує зміни, внесені для покращення якості коду, та результати аналізу в SonarCloud до і після рефакторингу.

